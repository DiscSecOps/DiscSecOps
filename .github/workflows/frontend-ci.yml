name: Frontend CI/CD

on:
  push:
    branches: [main, develop]
  pull_request:
    branches: [main]

jobs:
  frontend-ci:
    runs-on: ubuntu-latest
    
    # defaults:
    #   run:
    #     working-directory: ./frontend
    # REMOVED - Reason: We want to run from the Root to use the Makefile 
    
    steps:
    - name: Checkout code
      uses: actions/checkout@v4
    
    - name: Setup Node.js
      uses: actions/setup-node@v4
      with:
        node-version: '22' # This version should match the Dev Container (Dockerfile)
        cache: 'npm'
        cache-dependency-path: frontend/package-lock.json
    
    - name: Install frontend dependencies (clean)
      run: npm ci
      working-directory: ./frontend
    
    - name: Run Vitest unit tests
      run: make test-frontend-unit #npm run test:run
    
    - name: Install Playwright browsers
      run: npx playwright install chromium
      working-directory: ./frontend
    
    - name: Run Playwright E2E tests
      run: make test-e2e #npm run test:e2e
      env:
        CI: true
    
#    - name: Build frontend
#      run: npm run build
    
#    - name: Upload build artifact
#      uses: actions/upload-artifact@v4
#      with:
#        name: frontend-build
#        path: frontend/dist/
    
#    - name: Deploy to GitHub Pages
#      if: github.ref == 'refs/heads/main'
#      uses: peaceiris/actions-gh-pages@v4
#      with:
#        github_token: ${{ secrets.GITHUB_TOKEN }}
#        publish_dir: ./frontend/dist
#        cname: your-domain.com  # Optional

  #backend: Uncomment when backend is ready
  #backend-ci:
  #  runs-on: ubuntu-latest
  #  defaults:
  #    run:
  #      working-directory: ./backend
  #  
  #  steps:
  #  - name: Checkout code
  #    uses: actions/checkout@v4
  #  
  #  - name: Setup Python
  #    uses: actions/setup-python@v4
  #    with:
  #      python-version: '3.11'
  #  
  #  - name: Install backend dependencies
  #    run: pip install -r requirements.txt
  #  
  #  - name: Run backend tests
  #    run: pytest tests/
  #  
  #  - name: Build Docker image
  #    run: docker build -t backend-app .